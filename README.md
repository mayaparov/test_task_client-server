# test_task_client-server

Задание состоит из двух программ, которые необходимо реализовать. Взаимодействие программ должно быть реализовано через использование сокетов.

Программа №1.

Должна состоять из двух потоков и одного общего буфера.

Поток 1. Принимает строку, которую введет пользователь. Должна быть проверка, что строка состоит только из цифр и не превышает 64 символа. После проверки строка должна быть отсортирована по убыванию и все элементы, значение которых чётно, заменены на латинские буквы «КВ». После данная строка помещается в общий буфер и поток должен ожидать дальнейшего ввода пользователя.

Поток 2. Должен обрабатывать данные которые помещаются в общий буфер. После получения данных общий буфер затирается.
Поток должен вывести полученные данные на экран, рассчитать общую сумму всех элементов , которые являются численными значениями. Полученную сумму передать в Программу №2. После этого поток ожидает следующие данные.

Примечание №1 по Программе №1: Взаимодействие потоков должно быть синхронизировано, поток №2 не должен постоянно опрашивать общий буфер. Механизм синхронизации не должен быть глобальной переменной.

Примечание №2 по Программе №1: Работа программы должна быть максимально независима от статуса запуска программы №2. Это значит, что внезапный останов программы №2 не должен приводить к немедленным проблемам ввода у пользователя.

При перезапуске программы №2 необходимо произвести передподключение.

Программа №2.

Ожидает данные от Программы №1. При получении данных происходит анализ из скольки символов состоит переданное значение. Если оно больше 2-ух символов и если оно кратно 32 выводит сообщение о полученных данных, иначе выводится сообщение об ошибке. Далее программа продолжает ожидать данные.

Примечание №1 по Программе №2: Работа программы должна быть максимально независима от статуса запуска программы №1.
Внезапный останов программы №1 не должен приводить к немедленным проблемам отображения. Необходимо ожидать подключение программы №1 при потере связи между программами.

Для выполнения задания был написан код, который можно логически разделить на 3 части:

1. SocketServer: Класс, реализующий серверную часть приложения.

2. Buffer_str: Класс, реализующий буфер для хранения и передачи данных между потоками.

3. processInput, processOutput, processMessageQueue: Функции, реализующие отдельные потоки для обработки ввода, вывода и отправки данных.

Код:

SocketServer.cpp:

start(): Функция, запускающая сервер, создающая сокет, связывающая его с адресом и прослушивающая на нём подключение.<br />
sendMessage(int message): Функция, отправляющая сообщение в программу №2 по сокету.<br />
is_connected(): Функция, проверяющая состояние подключения к программе №2 и, при необходимости, переподключающаяся.<br />
set_connection(): Функция, устанавливающая подключение к программе №2.<br />
calculateSum(const std::string &input): Функция, подсчитывающая сумму цифр в строке.<br />
processOutput(): Поток, обрабатывающий вывод, получающий данные из буфера, обрабатывая их, подсчитывая сумму цифр и отправляющий результаты в очередь сообщений.<br />
processInput(): Поток, обрабатывающий ввод, получающий строку от пользователя, проверяющий её корректность, обрабатывая её и отправляющий обработанные данные в буфер.<br />
processMessageQueue(): Поток, отправляющий сообщения из очереди в программу №2 и обрабатывающий сообщения от неё.<br />

Buffer_str.hpp:<br />
Определение класса Buffer_str, реализующего буфер для безопасного хранения и обмена данными между потоками.

Buffer_str.cpp:<br />
get(): Функция, возвращающая данные из буфера.<br />
set(const std::string &newData): Функция, устанавливающая новые данные в буфер.<br />
clear(): Функция, очищающая буфер.<br />
waitForNewData(): Функция, блокирующая поток до тех пор, пока в буфер не будут добавлены новые данные.<br />

Переменные:

sockfd: Дескриптор сокета.<br />
newsockfd: Дескриптор сокета для подключения к программе №2.<br />
serv_addr: Структура, содержащая информацию об адресе сервера.<br />
cli_addr: Структура, содержащая информацию об адресе клиента (программы №2).<br />
port: Порт, на котором прослушивается сервер (8080).<br />
data: Объект класса Buffer_str, используемый для хранения и передачи данных между потоками.<br />
messageQueue: Очередь для хранения сообщений, которые нужно отправить в программу №2.<br />
messageQueueMutex: Мьютекс для синхронизации доступа к очереди сообщений.<br />
messageQueueCV: Условие для ожидания сообщений в очереди.<br />

Пример использования:

Сервер:<br />
Введите строку: <br />
11231445<br />
Полученная строка: 5KBKB3KB111<br />
Сумма чисел: 11<br />
Введите строку:<br />

Клиент:<br />
Полученные данные: 11<br />
Ошибка данных!<br />


